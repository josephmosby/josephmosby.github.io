<!doctype html>
<html>
	<head>

		<title>josephmosby.com</title>
		<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="/stylesheets/fibonacci.css" />
		<link rel="stylesheet" href="/stylesheets/custom.css" />

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

	</head>

	<body>

		<div class="wrapper" id="header">
			<div class="container">
				<div class="row">
					<div class="col-13">
						<a href="/"><h3>JOSEPH MOSBY</h3></a>

						<ul class="menu inline">
							<li><a href="/about">about</a></li>
							<li><a href="/projects">projects</a></li>
							<li><a href="/presentations">presentations</a></li>
							<li><a href="/now">now</a></li>
							<li><a href="/feed/atom.xml">subscribe</a></li>
						</ul>

						<a id="hamburger" href="#">MENU</a>
					</div>
				</div>
			</div>
		</div>

		<div class="wrapper" id="dropdown">
			<div class="container">
				<div class="row">
					<div class="col-13">
						<ul class="menu dropdown">
							<li><a href="/about">about</a></li>
							<li><a href="/projects">projects</a></li>
							<li><a href="/presentations">presentations</a></li>
							<li><a href="/now">now</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div class="wrapper" id="main">
			<div class="container">
				
<div class="row">
	<div class="col-3">
		<a href="/2016/02/29/a-february-recap-or-what-life-is-like-without-coffee.html"><h3>A February Recap or What Life is Like Without Coffee</h3></a>
		<div class="date">February 29, 2016</div>
	</div>
	<div class="col-8">
		<p>In February, I decided to enter life’s “Hard Mode.” I gave up caffeine completely.</p>

<p><img src="images/coffee-cup-working-happy.jpg" /></p>

<p>I had no idea how this experiment would work and what it would do for my productivity. Here is what I was able to accomplish in the month of February, in similar <a href="http://josephmosby.com/2016/01/29/a-january-recap-and-some-personal-experiments.html">format to my January recap</a>:</p>

<ul>
  <li>Read 9 books
    <ul>
      <li><a href="http://amzn.to/1KQp7Ad">Mastery</a> by Robert Greene</li>
      <li><a href="http://amzn.to/1KQpj2o">Radical Acceptance</a> by Tara Brach</li>
      <li><a href="http://amzn.to/1LJZDiO">Foundation</a> by Isaac Asimov</li>
      <li><a href="http://amzn.to/1LJZHPr">A Farewell to Arms</a> by Ernest Hemingway</li>
      <li><a href="http://amzn.to/1QKSZA8">Oryx and Crake</a> by Margaret Atwood (<a href="http://josephmosby.com/2016/02/14/oryx-and-crake.html">semi-recap here</a>)</li>
      <li><a href="http://amzn.to/1Q8cnE3">Influence: The Psychology of Persuasion</a> by Robert Cialdini</li>
      <li><a href="http://amzn.to/1Q8cvDp">A Million Miles in a Thousand Years</a> by Donald Miller</li>
      <li><a href="http://amzn.to/1QKTsm0">Trigger Warning: Short Fictions and Disturbances</a> by Neil Gaiman</li>
      <li><a href="http://amzn.to/1LK0f7T">Vagabonding: An Uncommon Guide to the Art of Long-Term World Travel</a> by Rolf Potts</li>
    </ul>
  </li>
  <li>Executed 50 pullups and 100 pushups in the same workout, and executed 30/60 with an additional 25 lb. weight attached to me</li>
  <li>Squatted 245 lb. for 5 repetitions</li>
  <li>Leg pressed 500 lb. for 5 repetitions</li>
  <li>Lost one or two inches off my waistline (this is an estimate, I just know my pants don’t fit)</li>
  <li>Attended my first two judo lessons</li>
  <li>Completed the first draft of my e-book on uWSGI</li>
  <li>Watched 20+ TED talks</li>
  <li>Wrote daily journal entries</li>
  <li>Got a tan and a sunburn in Rio de Janeiro while riding the waves on Copacabana Beach</li>
</ul>

<p>I again followed the practice of <a href="https://blog.bufferapp.com/why-having-no-goals-in-our-lives-might-make-us-happier-and-more-successful">not setting goals</a> in this month and focused on systems instead. I believe that this pushed me through the fog of an uncaffeinated mind, and perhaps ultimately strengthened my willpower.</p>

<h3 id="no-coffee">No Coffee</h3>

<p>I decided to go cold turkey off of coffee just before January wrapped up. I knew that many highly successful people had gotten off of caffeine over the course of their lives, and I thought it was a worthwhile experiment to try for myself. It turned out to be wildly different than my expectations.</p>

<p>The last time I tried to give up caffeine cold turkey, I was crippled with raging headaches and nausea that made me think I had the flu. I cracked after two days. This time, I gradually reduced my caffeine intake over the course of several months, ultimately consuming only the equivalent of half of a cup of
coffee per day. When I went off, I had a headache the first night, then did not have any pain afterward.</p>

<p>What I did not account for was “the fog.” The fog is a state of mind that exists somewhere between tired and fully awake, and I went through this state in varying degrees over the course of my experiment. My brain didn’t feel like it was moving as quickly while it was in the fog, nor was I nearly as motivated to get things done. After the first few days, I was completely functional at my day job, but at nighttime I would grind to get anything done. Though I read more books, lifted heavier weights, and finished my e-book’s first draft during this time period, I felt I had to mentally fight to do any of that. </p>

<p>I believe that it was the fight that made this entire experiment worthwhile. It’s one thing to knock out a bunch of tasks when hopped up on caffeine - it’s another thing to need to consciously decide what absolutely must be done when you know your caffeineless willpower can only handle so much. That willpower
training is invaluable. I look forward to having it when I allow myself caffeine once more.</p>

<h3 id="judo">Judo</h3>

<p>Judo is the first martial art I’ve practiced since I was a first grader. It is so much fun and I wish I had tried it earlier. It’s an intense workout. The warmups alone will make your core hurt, to say nothing of the part where you start tossing people around. It’s almost like an extremely physical chess match,
with grip position and balance being the dominant factors that win or lose matches rather than total strength. There’s no rush quite like it. I’m hooked already after only a few classes and will definitely be hungry for more in 2016.</p>

<h3 id="recycling">Recycling</h3>

<p>I dropped use of the <a href="https://lifesum.com">Lifesum</a> and <a href="https://www.thinkpacifica.com/">Pacifica</a> apps in the month of February. Lifesum was part of an experiment to clean up my eating habits by tracking my daily protein, carbohydrate, and fat intake. I instead focused on cooking more at home and not allowing myself some standard fast food cheats, and it’s far too difficult to track home-cooked meals easily in Lifesum. I scrapped Pacifica for similar reasons. When I dropped caffeine and began sleeping more, I noticed that my stress levels and mental well-being improved as well. I still have a lot that I want to do on the mindfulness front, but I don’t think this particular app will help me toward those goals. In addition, I took two bags of used clothing in for donation, gradually reducing the mental paces I put myself through to pick out what to wear.</p>

<h3 id="whats-next">What’s Next?</h3>

<p>In the first parts of the year, I focused on physical well-being. I’ve developed systems to help me maintain my health, some of which I may recycle or augment as I move into the next phase of the year: technical skills acquisition. For the next three months, I plan to focus on practicing and mastering some of the skills that make up my world as an engineer. I will allow myself caffeine again, but it still won’t be a daily thing. It will be an intentional dose to achieve specific tasks.</p>

<p>What are you working on in March? I want to hear about it! Let me know: <a href="https://twitter.com/josephmosby">@josephmosby</a></p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2016/02/29/a-february-recap-or-what-life-is-like-without-coffee.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2016/02/14/oryx-and-crake.html"><h3>Oryx and Crake</h3></a>
		<div class="date">February 14, 2016</div>
	</div>
	<div class="col-8">
		<p><em>Oryx and Crake</em> has haunted me for a longer period of time than any book I’ve read in years. Naturally, I think everyone should read it.</p>

<p>It isn’t the story that gets to you. Margaret Atwood does good work with the story-telling and writes a compelling tale with beautiful, complex characters. But it would be a standard enjoyable sciencey-fiction story in the vibe of many of the modern writers in that genre if it weren’t for the <em>implications.</em> </p>

<p>You know something horrible is going to happen from the beginning. When the book opens, the horribleness has already happened, and the reader is waiting for it to unfold in the ensuing flashback chapters. But as the crescendo builds to a frightening pitch, you realize that what you expected in chapter one is nowhere near as menacing and uncomfortably plausible as the apocalypse that Atwood has concocted for the reader. Eight months after the first read and I’m still thinking about it.</p>

<p>Go check it out. You won’t be disappointed.</p>

<p><a href="http://amzn.to/1ThRCI6">Oryx and Crake</a></p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2016/02/14/oryx-and-crake.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2016/01/29/a-january-recap-and-some-personal-experiments.html"><h3>A January Recap and Some Personal Experiments</h3></a>
		<div class="date">January 29, 2016</div>
	</div>
	<div class="col-8">
		<p>Over the month of January, I’ve achieved some major goals that I would have been happy with in three months. Instead, I’ve been able to get them done in one. I’m really excited about them, but before I share how I got there, I wanted to share what I knocked off the list:</p>

<ul>
  <li>Read 7 books
    <ul>
      <li><a href="http://amzn.to/1Qx8NmP">The Four-Hour Workweek</a> by Tim Ferriss</li>
      <li><a href="http://amzn.to/1Pn0VVM">The Girl With All the Gifts</a> by M.R. Carey</li>
      <li><a href="http://amzn.to/1Pn0ZVt">The Power of Habit</a> by Charles Duhigg</li>
      <li><a href="http://amzn.to/1KfazcB">Do Androids Dream of Electric Sheep?</a> by Philip K. Dick</li>
      <li><a href="http://amzn.to/1Qx8WXk">The Graveyard Book</a> by Neil Gaiman</li>
      <li><a href="http://amzn.to/1P1KQkF">The Demon-Haunted World: Science as a Candle in the Dark</a> by Carl Sagan</li>
      <li><a href="http://amzn.to/1P1KR8k">Love and Math</a> by Edward Frenkel</li>
    </ul>
  </li>
  <li>Executed 50 pullups and 100 pushups in the same workout (starting from 30/50 at the beginning of the month)</li>
  <li>Squatted 235 pounds for 5 repetitions</li>
  <li>Leg pressed 460 pounds for 5 repetitions</li>
  <li>Wrote five chapters of an e-book I plan to release on uWSGI</li>
  <li>Knocked out an optometrist and a dentist appointment</li>
  <li>Watched 20 TED talks</li>
</ul>

<p>I did all of this while working a standard workweek in a month where we launched a major project, while keeping my caffeine intake to a daily average of ~50mg (less than half of an average cup of black coffee). </p>

<p>So, how’d I pull this off? I certainly didn’t run myself into the ground to do it. I also didn’t set goals (with the exception of going to the dentist). Instead, I made small changes to my daily activity and set up systems to keep myself on track. Here’s what that looks like.</p>

<h3 id="morning-rituals">Morning Rituals</h3>

<p>I followed the exact same pattern almost every morning of the month, including on weekends. I use <a href="http://www.sleepcycle.com/">Sleep Cycle</a> to track my sleep patterns and wake me up at the optimal time. This is a zero-effort tool that I love. All you do is tell it the latest possible time you’re willing to wake up, flip your phone face-down on your bed, and go to sleep. Sleep Cycle takes care of the rest. Here’s a snapshot of the stats it produces: </p>

<p><img class="no-fill" src="/images/sleepcycle.PNG" /></p>

<p>The part of those statistics where I wake up at 5:30 isn’t an accident. I’ve been waking up before 6am almost every day of this month (I bump things back to 7am on weekends). I thought this would be a much rougher proposition than it actually is. I’m generally in bed by 11pm, which clocks me 7 hours of sleep each night (more than the <a href="http://www.gallup.com/poll/166553/less-recommended-amount-sleep.aspx">American average</a>). </p>

<p>At the beginning of the month, I started off with three days operating on the simplest food I could subsist on. In my case, that was brown rice and the cans of black beans I had accrued in my cupboard but never gotten around to opening. It was an eye-opening experience. It taught me gratitude for the things I have, and it also taught me that there was a lot in my life that was extremely wasteful but I kept around out of habit. After the three days, I started incorporating other foods into my diet, but have not deviated much from those staples. As a result, my breakfast each morning consists of sweet potato, black beans, egg whites, salsa, and tea. </p>

<p>I track all of this in an app called <a href="https://lifesum.com/">Lifesum</a>, selected because it integrates with Apple’s HealthKit. I focus on tracking my carbohydrate, my protein, my water, and my caffeine intake in HealthKit. Here’s what Lifesum looks like:</p>

<p><img class="no-fill" src="/images/lifesum.PNG" /></p>

<p>That was an easy day to top off on protein - my cousin’s wedding had an oyster bar as part of the reception, and oysters are perhaps my favorite way of getting protein.</p>

<p>Once breakfast is wrapped up, I meditate for ten minutes. This is accomplished by setting my phone’s timer and closing my eyes for ten minutes, pondering on the day ahead or nothing at all. In the past, I’ve also leaned on the <a href="http://www.calm.com/">Calm</a> and <a href="https://www.headspace.com/">Headspace</a> apps. I liked both of them, but I previously struggled to stick to their prescribed programs and then felt guilty when I slipped up. I also felt guilty if I got distracted in the middle of a meditation session. Going program-less means I think a lot more while meditating, but I also am far calmer and excited to take part in it each day. </p>

<p>After meditation, it’s time for the gym. On an average day, I’m walking to the metro by 6:45am, which puts me at the gym around 7:10. I alternate between the following two workouts:</p>

<ul>
  <li>Pullups/pushups. Start with a 10 pullup set and a 20 pushup set, and try to maintain that momentum per set until hitting 50/100. In the earlier parts of this month I scaled down my per-set requirements in line with what my maximum pullups and pushups were. By the end of this month I started my pullup sets off with 25lb additional weight attached to my waist. </li>
  <li>Squats, 5-rep sets starting from 135lb and incrementing upwards 10lb with each set. On days when the squat racks are full, I do an incline leg press starting from 90lb to warm up and incrementing up 50lb with each set, followed by 3 20-rep sets of 90lb calf raises.</li>
</ul>

<p>After the gym, it’s on to work. If I’ve got enough time and the temperature isn’t miserable, I’ll walk from Gallery Place to the Watergate. Otherwise it’s back on the subway.</p>

<h3 id="work-habits">Work Habits</h3>

<p>I feel that the most significant habits have come in my style of working this month. I read Tim Ferriss’ <em>The Four-Hour Workweek</em> in the first days of the month after listening to several of his podcasts on my vacation drives. There’s a lot of material in there, and I did not try to implement everything all at once. I did, however, heed his admonition about batch processing during the workday. There is a switching cost each time your brain has to change its focus from one task to another and you lose a lot of the momentum your brain picked up while knocking out the past task. In my line of work, my primary distractions are email, social media, and Slack. To that end, I experimented with checking email at certain times of the day and switching off Slack notifications. That turned out to be a bit too aggressive of a shift. I instead dialed it back to checking personal email once a day and flipping off Slack’s notification system unless my name is directly called out in a message. This has really helped my focus and I’ve plowed through a lot more work as a result.</p>

<p>I also put myself on a media diet, another trick from <em>The Four-Hour Workweek</em>. That means zero news. I’ve been off Twitter completely over the course of this month, deleting the app from my phone and never signing on the desktop version. I haven’t signed into Hacker News once, my primary source of technology news. I’ve picked up some political coverage given the nature of my job, but I’ve had to ask a lot of questions to reporter friends because I just don’t know what’s going on. I only found out who won the NCAA national championship just yesterday. This has been an extremely significant change for me. My head is a lot clearer, and I’m able to focus on code, books or writing in times when I would have normally flipped through news articles or my Twitter feed. I don’t feel the compulsive need to distract myself. </p>

<h3 id="whats-next">What’s Next?</h3>

<p>This month, I organized everything around a focus on physical well-being. The waking up early and going to bed early was a huge step in that direction, as was the working out, the meditation, the lack of drinking, and even things as simple as flossing. (seriously, I have to track that or I’ll never remember to do it) I’m tracking all of these daily habits in an app called <a href="http://wayoflifeapp.com/">Way of Life</a> that looks like this:</p>

<p><img class="no-fill" src="/images/wayoflife.PNG" /></p>

<p>I’ll continue that focus on physical well-being in February. I may take on projects here and there, but my focus is on my health. Nothing else before that. I also plan to embark on another series of three days where I eat nothing but rice and beans and spend as little money as possible to focus on what I have in life. I found that experience to be incredibly rewarding (though tough) and definitely something I should do regularly. If you’re reading this, I’d love to hear about how your year started off, and what’s up next for you in February!</p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2016/01/29/a-january-recap-and-some-personal-experiments.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/12/26/2015-a-year-on-the-road-in-2015.html"><h3>A year on the road in 2015</h3></a>
		<div class="date">December 26, 2015</div>
	</div>
	<div class="col-8">
		<p>It’s 2015. I wake up on a couch in San Francisco after a ridiculous circus party to close out the year before.</p>

<p>I enjoy waking up on couches in San Francisco more than the best bed anywhere else. The sun is different in California, it seems brighter somehow. San Francisco is a foggy grey color half of the time, but when the sun comes out, it makes it so easy to forget the fog ever existed. Take a look for yourself:</p>

<p><img src="/images/2015_retro/sf.png" alt="Picture of me standing in front of San Francisco Bay" /></p>

<p>Cities are the waypoints of 2015 in my mind. I remember my mental state by remembering where I was when going through one situation or another. I’m cooking breakfast at Sean and Alex’s pad on Potrero Hill when I receive an email from a recruiter with a proposition to join a media organization in Foggy Bottom to rebuild their content management system. Linda prompts me to dig deeper into this particular recruitment offer, overriding my typical approach of discarding recruiter emails. It takes only a few calls and one in-person interview before I’m convinced, and I move into the Watergate building a few weeks later.</p>

<p>Three days later, I’m on a plane to the Middle East.</p>

<p><img src="/images/2015_retro/dubai.png" alt="Picture of the Burj Khalifa and Dubai skyline" /></p>

<p>I’ve never been to Dubai or Muscat, nor have I ever taken an international trip with a large group of friends. It’s a dream come true to be with a good crew in the Middle East exploring a culture that is entirely foreign to me. Stealing a sip of Linda’s gold-flecked cappuccino in the Burj al Arab (for real, gold flakes in the coffee); swimming to a giant inflatable castle in the Arabian Sea; riding a camel; watching the Dubai Mall fountain show - none of it could be any better. Linda, Crowley, Medved, Sonal, Nikki, Ravi, Adam, Katy, you’re an extraordinary crew to travel with and I’m looking forward to the next run.</p>

<p><img src="/images/2015_retro/camel.JPG" alt="Picture of me on a camel" /></p>

<p>The spring ramps up. I get to work and kick my engineering education into high gear. I had learned how to skin up a Drupal site on the quick at APCO, but that is nothing compared to what building out National Journal has to teach me about the web. I learn proper recursion while building out an ORM-to-MongoDB-document converter. I learn about all of the ins and outs of the Django administrative console. I learn how to build Python code for production. </p>

<p><img src="/images/2015_retro/pycon.png" alt="Picture of PyCon 2015 attendees" /></p>

<p>I’m at PyCon in April. There is nothing quite like the feeling of recognizing that you’re in the middle of your tribe. In Montreal, I suddenly find myself in the middle of a huge group of engineers who wanted what I wanted - to produce great and technologically interesting things using Python. And they want it for everyone! And I am in Montreal, using my middling French to chat with the locals, exploring a city that is simultaneously European and North American all in one. </p>

<p>Now I’m back in DC, and the weather is warm. I’m getting to know my journalist co-workers as we play softball together. Every Saturday I haul out to the middle of the Maryland suburbs to wildly miss pitches. Baseball was never my strong suit, but Matt, Alex, Zach, Paloma, Randy, Drew, and the rest of the Atlantic Media crew made it worthwhile every weekend.</p>

<p><img src="/images/2015_retro/softball.png" alt="Picture of our softball team" /></p>

<p>It’s June now. The weather’s hot. I’m on the road to New York City for Governor’s Ball, the first festival I’ll do with Linda and our motley crew of friends. Linda and I make a best effort to catch Blake, Ouzy, Jeff, and Kendra in between acts, but eventually Linda and I lose them all to sprint as close as we can for Drake’s set to close the night. We fare better the next day, bringing Blake with us to the front of the stage to watch deadmau5’s stage fail before he hung out on a couch to drink a beer with Left Shark and a giant hot dog. As one does.</p>

<p><img src="/images/2015_retro/deadmau5.png" alt="Picture of deadmau5 on a couch with Left Shark" /></p>

<p>July comes and it’s time to hit the road again for an aggressively long roadtrip. DC to Nashville. Nashville to Asheville. Asheville back to DC. Over a thousand miles of open road covered in the Civic. In Nashville, my massive extended family gathers for our almost-triannual family reunion, bringing together some 60-odd Mosbys, Harwoods, and Grimes together for hot chicken contests and beer drinking in cheap honky tonks. I have the good fortune of knowing so many of my family members through a variety of different channels, being the only one to have lived in our three central hubs of Jackson, Nashville, and DC. I consider myself blessed to have had the opportunity to get to know so many of them.</p>

<pre><code>No man ever steps in the same river twice, for it is not the same river and he is not the same man.
</code></pre>

<p>My visit to Nashville kicks off a series of meditations that I consider while on the road. I visit my old college campus and realize that the entire center of gravity of the school has shifted, and there are at least five new buildings I don’t recognize. The run down area where I used to buy beer out of a warehouse has sprouted condo buildings. I am no longer an active musician. At some point Nashville moved on after I left, and I moved on too. We are not the same. </p>

<p><img src="/images/2015_retro/boltons.png" alt="Picture of Bolton's spicy chicken and fish" /></p>

<p>I return to Washington to learn that our owner has decided that National Journal will no longer print our flagship magazine. Policy and politics coverage is tough to do in a weekly publication, and our targeted readership is reading their news online like the rest of the country. The tenor of the newsroom shifts. It’s tough to see some of the good people I played softball with so distraught. Our digital team reassesses certain portions of our web product and we prepare for a September 1 relaunch. I go to Chicago that weekend.</p>

<p><img src="/images/2015_retro/chicago.png" alt="Picture of Chicago skyline" /></p>

<p>Chicago holds a special place in my heart that is perhaps rivaled only by San Francisco. I have never lived in either place. I know Chicago’s winters are dreadful and that I am supposed to feel differently if I had to spend January there with the wind whipping off the lake. But there is something special about the city. There is a union there between the parts of my heart that will always be from a small town and the parts that crave the excitement of the city. </p>

<p><img src="/images/2015_retro/oh_200ok.png" alt="Picture of the Ohio 200 OK license plate" /></p>

<p>A few weeks later I take off again for the open road. Columbus, Ohio beckons, where I will give my <a href="http://www.pyvideo.org/video/3712/production-django-building-a-highly-scalable-se">first talk</a> at a programming conference. I expect to give a retrospective on some of the things we learned while building NationalJournal.com, but we’re still in the middle of building it. A few of the questions stump me, but it is overall a good first talk. I am proud.</p>

<p><img src="/images/2015_retro/folly.png" alt="Picture of the Folly Beach crew" /></p>

<p>I lived with the same group of guys for most of my college and grad school experience. We shared dorm suites together, then an apartment, then a house on Belmont Boulevard, then a two bedroom apartment in Brentwood, Tennessee. Two of these guys are now married, with children either in house or on the way. One of them is a Ph.D. We get together and it’s just like we’re undergraduates again, with the same conversations and nerd humor that propelled us through our time at Belmont. We spend a long weekend in Charleston, South Carolina, hanging on the beach, eating tacos, drinking good wine (thanks, Adam!).</p>

<pre><code>I've been in the crib with the phones off, I've been in the house taking no calls...
Drapes closed, I don't know what time it is, I'm still awake, I gotta shine this year
</code></pre>

<p>August continues to roll on. When I’m not on the road speaking at conferences or at the beach, I’m in the office pulling 12-15 hour days to ship NationalJournal.com on time. I gain weight after eating nothing but trash for a month and rarely working out. I’m fueled by caffeine only, because I can’t sleep once I get home. We’re doing nightly builds, shipping emergency bug fixes day in and day out, none of the team leaving until the day’s tickets are done. Finally, on August 31, we turn the switch on. NationalJournal.com goes live. Brian, Robert, Paivi, Julia, Ivy, Kim, Lindsey, Jeremy and I finally get a good night’s sleep.</p>

<p><img src="/images/2015_retro/nj.png" alt="Picture of NationalJournal.com" /></p>

<p>After shoring up the codebase from the many shortcuts we took to launch on time, I head to Colorado for Jeff and Kendra’s wedding. It’s my first-ever visit to Colorado. I arrive in Denver late Thursday night and pick up a giant 15-passenger van dubbed “The Mystery Machine.” In the morning I pick up the Scooby Squad: MariaElena, Prather, Kyra, Hannah, Clarissa, Levi, Ryan, Juliana and Dalesio. We meet Jeff, Kendra, Sam, Pam, Ethan, and Ellen in what must be God’s country - Cuchara, Colorado. They serve Pueblo green chili with every meal and the entire landscape is flashes of bright yellow, desert green, and a piercing blue hanging in the sky. We hike to the top of the nearest mountain before descending to celebrate the happy couple. </p>

<p><img src="/images/2015_retro/cuchara.png" alt="Picture of Dalesio, me, MariaElena and Sam on our hike" /></p>

<p>October turns the tables at the office again. Only a few short weeks after we relaunched NationalJournal.com, our owner has decided that the news business at a whole needed a shakeup. No more public-facing news and no more ads. Everything will be for the service of our paid members. Many of my friends in the office leave to take jobs at competing news organizations, landing at <em>The New York Times</em>, <em>Vox</em>, <em>The Washington Post</em>, and others. We prepare for the shift to an ad-free world, and I begin to reimagine parts of our code. </p>

<p>For the first time I get to have my entire family with me in Washington. Dad is coming up to run the Marine Corps Marathon and we’re all ready to cheer him on. He’s been working on this for months and has lost a ton of weight. I get to spend the days preceding the marathon showing the city (and its excellent restaurants) off to my family. On Sunday, it’s race day, and Dad knocks out the 26.2 miles like a champion!</p>

<p><img src="/images/2015_retro/mcm.png" alt="Picture of Dad's marathon stats" /></p>

<p>The downward mental slide that started in September continues in November. The site has a resiliency problem that resists debugging, and I struggle to fight off anger against the thing I’ve made. I turn into a packaged ball of stress, worrying at any moment that the site is going to crash and I’ll need to manually bring it back up. The constantly changing weather brings with it a sickness I can’t shake. The combination of the above brings on a spat of panic attacks that convince me I’m about to stop breathing. I hit a low, hard. I drag myself to work every day feeling like my creativity and my ambition have both fallen through the floor. All I want is out. </p>

<p>And then something happens.</p>

<p>I grow up. </p>

<p><img src="/images/2015_retro/magic.png" alt="Picture of the magic cup of awesome" /></p>

<p>On Thanksgiving Day, I drive out to Chestertown, Maryland to spend the day with my extended family. We’re frying turkeys this year - or rather, Uncle David is frying a turkey and I’m drinking Heineken while taking video. I’ve downloaded a few podcasts for the drive to Chestertown, deciding I’ll give this surge in podcasts a shot. I burn through a few really enjoyable tracks, but it’s <a href="https://twitter.com/tferriss">Tim Ferriss</a> who grabs me. He’s recorded an in-between podcast for the Thanksgiving holiday about <a href="http://fourhourworkweek.com/2015/11/29/magic-of-mindfulness/">mindfulness and gratitude</a>. I listen through it twice. In it, Tim details a few daily things he’s done to change the way he interacts with the world, and I start on them as soon as I get home. I set up a Magic Cup of Awesome and start ripping up scraps of paper to write down the things I’m grateful for in a given day. I strap on a bracelet (read: I steal one of Linda’s hair ties) as a reminder to stop complaining. These positive habits kick off a series of changes in my life. I grow up.</p>

<p><img src="/images/2015_retro/monument.png" alt="Picture of the Washington monument in December" /></p>

<p>The weather in DC still can’t make its mind up, even in December. We enjoy 70 degree days. We endure 30 degree days. These happen within the same week. The work continues. I pack the bags up to hit the road again, homeward bound. I stop over in Nashville for the night, spending the evening with Daniel, Helen, Monroe, Adam, Ian, Mary, and Roger. </p>

<p>Monroe is Daniel and Helen’s first son. Roger will be Ian and Mary’s. Adam has a little daughter, but she wasn’t around for our hot chicken fiesta that night. When I left Nashville to move to DC, those couples were starting on a journey of married life. Now they are exploring life with children. They have wonderful lives together and homes in one of America’s great cities, a city which is itself growing by leaps and bounds. I imagine Nashville in 2015 is an exciting place to start a family.</p>

<p>It’s morning. I must hit the road again.</p>

<p><img src="/images/2015_retro/puzzle.png" alt="Picture of a puzzle" /></p>

<p>It’s December 23rd. My brother arrives in Jackson, MS tonight, and we’ll have the entire family together again. For Christmas Eve, we’ll continue a tradition started last year: Lou Malnati’s pizza for dinner, shipped frozen from Chicago and baked here at home. Linda arrives on the 26th for her first visit to the Magnolia State. While planning for her few days here in town, I reimagined the city as a first-time traveler would. What does downtown Jackson look like? What is Fondren? What do the Christmas lights look like in Canton? </p>

<pre><code>Nothing behind me, everything ahead of me, as is ever so on the road. 
</code></pre>

<p>I woke up in 2015 running from something. I thought there must be this entire world out there that I was missing out on, and I needed to run to Nashville or San Francisco or DC or New York or London or Paris or Amsterdam or Istanbul to find it. Whatever it was, it was always just beyond my reach. In 2015, somewhere out there on the road, I found it. An optimism, perhaps, or just a calm belief that I’ll find and achieve whatever it is that I’m meant to. </p>

<p>I will wake up in 2016 on a couch in the Florida Keys, closer to Havana or Cancun than my apartment in Washington. Then I’ll start a 1,200 mile dash back to Washington, retracing the same steps I took to return from Charleston. I’ll wave at Jacksonville and Savannah as I go straight up I-95, which stretches on up to Philadelphia, New York, Boston, up, up, up until it crosses into Canada near Houlton, Maine. You split into Canada Highway 2 at that point, which will take you north before changing into Autoroute 20 O, whipping past Quebec City (where there are ice hotels) and into Montreal. From there you can catch a flight to Dublin for $500 or south to Punta Cana if there’s a deal going on. Or just keep driving, on into the west, crossing back over into the United States at Detroit, catching the California Zephyr in Chicago and on to San Francisco. And then a quick flight back to DC to do it all over again.</p>

<iframe class="desktop_map_embed" src="https://mapsengine.google.com/map/u/0/embed?mid=zwj5ygdqFNoo.k0PeQHjzWkU0" width="780" height="480"></iframe>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/12/26/2015-a-year-on-the-road-in-2015.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/10/31/an-introductory-look-at-erlang.html"><h3>An introductory look at Erlang</h3></a>
		<div class="date">October 31, 2015</div>
	</div>
	<div class="col-8">
		<p>I wanted to take a step back from operating systems to consider how another programming language views the world. Operating systems in the Unix world require knowledge of C: something that expands my programming mind but often feels like the Python knowledge I already know, just at a lower level. I wanted to pick something totally new, and so I’m going with <a href="http://learnyousomeerlang.com/">Erlang</a>.</p>

<p>Erlang is an <em>imperative</em> language: which means once you set a variable, it doesn’t change. That means a statement like <code>i++</code> or <code>i += 1</code> won’t work. I assume that Erlang has an elegant way of dealing with this, but I’m very early on in this book. Erlang does this to ensure that functions with the same parameters will always return the same results, regardless of the state elsewhere in the application. </p>

<p>The language makes use of something called an “actor model.” Each “actor” is a separate process in the Erlang virtual machine, calmly waiting for tasks but mostly sitting around doing nothing. Each process can do a very limited set of tasks. Each process is also totally segregated from other processes - without passing very transparent messages back and forth, processes don’t have the ability to communicate. Erlang also appears to come with a standard library that’s almost as fully featured as Python’s: debugging tools, a web server, a database, all the tools I generally rely on to get programming work done. </p>

<p>The <em>Learn You Some Erlang</em> book also makes a point to call out overzealousness in the Erlang community. Erlang caught my eye because of its concurrency and scalability (or rather, people talking about Erlang’s concurrency and scalability), but this book makes a point to calm those expectations a little bit. Just because you can divide everything up into actors doesn’t mean you should. The authors point out that Erlang is fantastic for things like server-level software and is mostly terrible at things like image processing. Exceptions can be made, of course. As I’m interested in things like server-level software and not so interested in image processing, I’m excited to get under the hood. </p>

<p>And with that, let’s get started.</p>

<pre><code>$ brew install erlang
$ erl
</code></pre>

<p>I continue on to the next chapter and discover this line:</p>

<pre><code>The Erlang shell has a built-in line editor based on a subset of Emacs, a popular text editor that's been in use since the 70s. If you know Emacs, you should be fine. For the others, you'll do fine anyway.
</code></pre>

<p>I am skeptical. I strongly dislike Emacs because every time I try to grok it, I trip over my feet and mostly destroy my entire program. Whatever, onward. Ctrl+A moves me to the beginning of a line, Ctrl+E to the end in Erlang-world. In the current version of Erlang compiled for OSX, it appears that Erlang opens you right into a shell. If I want to get out of it to enter some commands, I hit Ctrl+G. If I can’t remember what I’m supposed to do once I get out of the shell, I hit <code>h</code>. If I want to see a listing of all my current jobs, I hit <code>j</code>… oh, and I bet this is like doing <code>ps -ef</code>, but for the virtual machine. Okay, now I want to get back into my shell… hmm. Struggling to that with the instructions given. I’m going to have to trust that I’ll figure it out as time goes on. </p>

<p>Calling it a day for there. I’ll come back to it in earnest after I’ve digested a few things about the language.</p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/10/31/an-introductory-look-at-erlang.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/10/29/setting-up-a-simple-testing-tool-with-selenium-and-phantomjs.html"><h3>Setting up a simple testing tool with Selenium and PhantomJS</h3></a>
		<div class="date">October 29, 2015</div>
	</div>
	<div class="col-8">
		<p>Okay, this will be a short one, but I’ve just set up a minimalistic testing tool using Python, Selenium and PhantomJS and wanted to put it out there. Let’s get cracking.</p>

<p>Start off by installing PhantomJS using Homebrew:</p>

<pre><code>$ brew install phantomjs
</code></pre>

<p>And then move on to add Selenium into the mix (assuming still that you’re using Python):</p>

<pre><code>$ pip install selenium
</code></pre>

<p>And now let’s build our first test case. I’m working as part of a Django app so I’ll be using the Django <code>TestCase</code> object, but this will work very similarly with Python’s core <code>unittest.TestCase</code>. </p>

<pre><code>import os
os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = '127.0.0.1:9001'

from django.test import LiveServerTestCase
from selenium import webdriver

@classmethod
def setUpClass(cls):
	cls.driver = webdriver.PhantomJS()

@classmethod
def tearDownClass(cls):
	cls.driver.quit()
</code></pre>

<p>That’s all it takes to get started. Honestly. Just install PhantomJS through Homebrew and Selenium through pip, and you’re ready to get testing. Django’s <code>LiveServerTestCase</code> needs a <code>DJANGO_LIVE_TEST_SERVER_ADDRESS</code>, so I’ve set one of those up as an environment variable. The <code>setUpClass()</code> and <code>tearDownClass()</code> methods are part of the <code>LiveServerTestCase</code> class, and are used to initialize behavior when the tests begin to run or to close things no longer needed after the test is completed. In this situation, we’re using <code>setUpClass()</code> to set up our PhantomJS instance that we’ll subsequently close in <code>tearDownClass()</code>.</p>

<p>With my particular test situation, I needed to execute some JavaScript on each page I planned to test. That JavaScript would return a variable, set to either 1 or 0 based on the state of an object on the page. Here’s how we’ll extend our code to do that:</p>

<pre><code>import os
os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = '127.0.0.1:9001'

from django.test import LiveServerTestCase
from selenium import webdriver

@classmethod
def setUpClass(cls):
	cls.driver = webdriver.PhantomJS()

@classmethod
def tearDownClass(cls):
	cls.driver.quit()

def test_one_or_zero_on_link_one(self):
	self.driver.get('http://127.0.0.1:9001/linkone')
	should_be_zero = self.driver.execute_script('return case.a')
	self.assertEqual(should_be_zero, 0)

def test_one_or_zero_on_link_two(self):
	self.driver.get('http://127.0.0.1:9001/linktwo')
	should_be_one = self.driver.execute_script('return case.a')
	self.assertEqual(should_be_one, 1)
</code></pre>

<p>I’ve now added two official tests to the mix. I’m asserting that on {DOMAIN}/linkone, there should be a JavaScript object called <code>case</code> with a property <code>a</code> that’s set to zero. On {DOMAIN}/linktwo, that property should be set to one. In these two tests, I open the links up in PhantomJS (something you’ll never see, by design). I then execute JavaScript on the pages and pick up the return values with <code>self.driver.execute_script()</code>. This allows me to tap some of the context of the page state through JavaScript.</p>

<p>My tests did not need anything much more complex than that, but I’m looking forward to using this in several other contexts in future tests. PhantomJS is wicked fast compared to running the same code using Selenium’s Firefox or Chrome drivers. And being able to plug it into on-page JavaScript (maybe even tag-teaming with QUnit) makes it that much more appealing.</p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/10/29/setting-up-a-simple-testing-tool-with-selenium-and-phantomjs.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/10/27/the-xv6-filesystem.html"><h3>The xv6 filesystem</h3></a>
		<div class="date">October 27, 2015</div>
	</div>
	<div class="col-8">
		<p>The file system of an operating system is one of those things I haven’t thought about in years, ever since I went through the painful process of reformatting USB sticks when different versions of Windows used different file systems. But I’ve never really thought about how those things have to be implemented. </p>

<p>On xv6, files are either data files, which are “uninterpreted byte arrays,” and directories, which are references to data files or other directories. So a directory is nothing more than a special file that points to other files. Cool. Directories form a tree starting at the root, and a path is a set of directories going out from the root. If a path doesn’t start with a root, paths start from the current working directory of a given process. </p>

<p>That means <code>chdir()</code> is a system call that changes the current working directory of a process, and <code>mkdir()</code> is the system call that creates a new directory. <code>mknod()</code> is a similar call that creates a kernel device (such as a keyboard). When a process opens the kernel device file, the kernel will redirect the <code>read()</code> and <code>write()</code> to the kernel device instead of to a specific data file.</p>

<p>The <code>fstat()</code> call gives information about a specific object that a file descriptor points to. <code>fstat(fd)</code> takes in a file descriptor and returns a C <code>struct</code> called <code>stat</code>, which has an implementation that looks something like this:</p>

<pre><code>#define T_DIR 1 // directory
#define T_FILE 2 // file
#define T_DEV 3 // device

struct stat {
	short type; // type of file
	int dev; // file system's disk device
	uint ino; // inode number
	short nlink; // number of links to file
	uint size; // size of file in bytes
}
</code></pre>

<p>The name of the file is not included in this information table, because names are distinct from the actual file. An “inode” is the only unique identifier of a file that the kernel sees: names are just “links” back to an individual inode. Thus the following system calls will create two names for a file with the same inode:</p>

<pre><code>open("a", O_CREATE|O_WRONLY);
link("a", "b");
</code></pre>

<p>Calling <code>fstat()</code> on either of the file descriptors attached to “a” or “b” will demonstrate that they’re tied back to the same file with the same inode number. <code>unlink()</code> will do the opposite of <code>link()</code>. It deletes the name, but will not delete the file itself.</p>

<p>In xv6, these types of operations are implemented as user-level programs, rather than baking the system calls into the shell itself. <code>mkdir</code> is not a direct call to the system, but a user program that calls the <code>mkdir()</code> system call. Same with <code>rm</code>. <code>cd</code> is a notable exception, because it changes the working directory of the shell itself rather than a child process of the shell.</p>

<p>And that’s it for the xv6 system calls! I can treat the xv6 kernel as something abstracted away now that I have all of the system calls for interacting with it. </p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/10/27/the-xv6-filesystem.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/10/26/pipes-and-such.html"><h3>Pipes and such</h3></a>
		<div class="date">October 26, 2015</div>
	</div>
	<div class="col-8">
		<p>In MIT’s <a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-828-operating-system-engineering-fall-2012/lecture-notes-and-readings/MIT6_828F12_xv6-book-rev7.pdf">text on the xv6</a>, pipes are described as “a small kernel buffer exposed to process as a pair of file descriptors, one for reading and one for writing.” I think I understand file descriptors by now, but I don’t quite know what a buffer is. Let me dig into that first with some Googling.</p>

<p>Wikipedia describes a buffer as “a region of a physical memory storage used to temporarily store data while it is being moved from one place to another.” Cross-referencing this with other things I’ve previously learned about operating systems makes me think that buffers are probably also used for things like keyboard input - where we don’t want to necessarily take the time for expensive writes to disk, so we just store in memory and wait until another program clears things out. Okay. Moving on.</p>

<p>This example code was provided by the text: </p>

<pre><code>int p[2];
char *argv[2];

argv[0] = "wc";
argv[1] = 0;

pipe(p);

if(fork() == 0) {
	close(0);
	dup(p[0]);
	close(p[0]);
	close(p[1]);
	exec("/bin/wc", argv);
} else {
	write(p[1], "hello world\n", 12);
	close(p[0]);
	close(p[1]);
}
</code></pre>

<p>And this compiles nicely with some tweaks for the OSX environment - but, as it never prints, we don’t have a visual confirmation. </p>

<p>Pipes and temporary files share some similarities in execution. This code would look the same way to the end user:</p>

<pre><code>$ echo hello world | wc
$ echo hello world &gt; /tmp/xyz; wc &lt;/tmp/xyz
</code></pre>

<p>But there are three key differences here. This would leave the <code>/tmp/xyz</code> file lying around, which we’d have to come back through and clean up later. It also expects there to be enough free disk space for the <code>/tmp/xyz</code> file, which could be extremely long. And finally, these processes could not easily send data back and forth with this approach, if <code>wc</code> needed to send data back to <code>echo</code>. </p>

<p>And that’s it for pipes. Next, on to the filesystem!</p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/10/26/pipes-and-such.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/10/22/the-fast-inverse-square-root-algorithm.html"><h3>The fast inverse square root algorithm</h3></a>
		<div class="date">October 22, 2015</div>
	</div>
	<div class="col-8">
		<p>Taking a break from operating systems to do some algorithm training: something I revisit about once a year. I have the Khan Academy bit on the <a href="https://www.khanacademy.org/computing/computer-science/algorithms/towers-of-hanoi/a/towers-of-hanoi">Towers of Hanoi</a> up, but I want to first pause to go look at Quake’s “fast inverse square root” algorithm.</p>

<p>An inverse square root is used to calculate vectors for lighting and reflecting, so it’s incredibly useful for video games and rendering. Rendering uses millions upon billions of these tiny calculations, so a speedup over floating-point division can make a game much, much faster. Quake sped it up with the following steps:</p>

<pre><code>1. Take a floating point number n.
2. Shift the bits of n to treat n like an integer.
3. Shift n right one bit to make longword w.
4. Subtract w from the magic number 0x5f3759df (this step made a Quake developer comment "what the f***" in the code)
5. This number is within a few percentage points of the final answer. 
6. One iteration with the Newton-Raphson method to come to the final answer.
</code></pre>

<p>I was amused by this approach and can only imagine the total confusion on the part of the developer when the algorithm worked. </p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/10/22/the-fast-inverse-square-root-algorithm.html" data-via="josephmosby">Tweet</a>
	</div>
</div>

<div class="row">
	<div class="col-3">
		<a href="/2015/10/21/nginx-wont-timeout-and-other-tails-from-the-logfiles.html"><h3>nginx won't timeout, and other tails from the log files</h3></a>
		<div class="date">October 21, 2015</div>
	</div>
	<div class="col-8">
		<p>We had yet another instance of nginx allowing requests to spin into infinity, and now I’m starting to get a little frustrated with it. I’m going to take a different tack and see if I can sniff out the point when these requests start to blow up. To do this, I’m going to use the <code>awk</code> tool to find any and all requests that take longer than 3000 milliseconds, which is well beyond the tolerance point for my application. Most of our requests average out in the 100-150ms range, with long running requests taking 500ms. Let’s dump some things out from the log files.</p>

<pre><code>cat django-www.log | awk '$33 &gt; 3000 {print NR-1 ": " $0;}' &gt; high.log
</code></pre>

<p>So what this little snippet will do is <code>cat</code> the entire log file out, then pipe the output through an <code>awk</code> command. The syntax of <code>awk</code> breaks the file up based on delimiters (I think space is the default), which you can then access by number. <code>$33</code>, in this case, is the 33rd character, which is our millisecond mark. If it’s greater than 3000, I print the line number, the line itself, then dump all that out to a file called <code>high.log</code>.</p>

<p>Onward.</p>

<p>I don’t know why this stuck out to me, but I gave the address space usage and the rss usage of my uwsgi threads a second look this time. Here’s what they look like under normal traffic for a small sample.</p>

<pre><code>{address space usage: 3510480896 bytes/3347MB} {rss usage: 84557824 bytes/80MB} [pid: 5542|app: 0|req: 394/98579] 
{address space usage: 3510046720 bytes/3347MB} {rss usage: 101765120 bytes/97MB} [pid: 5875|app: 0|req: 387/98580] 
{address space usage: 3510497280 bytes/3347MB} {rss usage: 106389504 bytes/101MB} [pid: 6922|app: 0|req: 70/98581] 
{address space usage: 3510497280 bytes/3347MB} {rss usage: 106500096 bytes/101MB} [pid: 6922|app: 0|req: 71/98582] 
{address space usage: 3521171456 bytes/3358MB} {rss usage: 135237632 bytes/128MB} [pid: 4706|app: 0|req: 660/98583] 
{address space usage: 3510046720 bytes/3347MB} {rss usage: 101765120 bytes/97MB} [pid: 5875|app: 0|req: 388/98584] 
{address space usage: 3510480896 bytes/3347MB} {rss usage: 84557824 bytes/80MB} [pid: 5542|app: 0|req: 395/98585] 
</code></pre>

<p>The address space usage hovers at about 3.3GB, but the rss usage averages out around 100MB under normal traffic. Here’s what it looks like when we spike:</p>

<pre><code>{address space usage: 3518722048 bytes/3355MB} {rss usage: 148234240 bytes/141MB} [pid: 28562|app: 0|req: 4128/36509]
{address space usage: 3537321984 bytes/3373MB} {rss usage: 153063424 bytes/145MB} [pid: 28827|app: 0|req: 4137/36512]
{address space usage: 3518103552 bytes/3355MB} {rss usage: 125833216 bytes/120MB}
{address space usage: 3537321984 bytes/3373MB} {rss usage: 153255936 bytes/146MB} [pid: 28827|app: 0|req: 4138/36517]
{address space usage: 3518722048 bytes/3355MB} {rss usage: 148992000 bytes/142MB} [pid: 28562|app: 0|req: 4137/36523]
{address space usage: 3518722048 bytes/3355MB} {rss usage: 148992000 bytes/142MB} [pid: 28562|app: 0|req: 4137/36525]
</code></pre>

<p>Our address space usage is the same, but our rss usage is pushing over 142MB for almost every request. I want to dig more into this.</p>

<p>I stumbled upon this discussion thread on the <code>uwsgi</code> issues page from someone experiencing the same sort of performance degradation with almost the same sort of configuration that we have: <code>uwsgi</code>, <code>supervisord</code>, Django. The solution suggested here is to add <code>die-on-term=True</code> to our <code>uwsgi</code> config, but I want to look into that a little more before I just start adding things to our <code>uwsgi</code> config. (the issue thread is <a href="https://github.com/unbit/uwsgi/issues/296">here</a>)</p>

<p>The issue is distilled <a href="http://uwsgi-docs.readthedocs.org/en/latest/ThingsToKnow.html">here</a> (second bullet). Before uWSGI 2.1, sending the <code>SIGTERM</code> signal to <code>uwsgi</code> means “brutally reload the stack”, which is not convention. <code>SIGINT</code> or <code>SIGQUIT</code> has the same behavior in uWSGI that <code>SIGTERM</code> has in other applications. Searching for <code>supervisord SIGTERM</code> yielded this StackOverflow answer:</p>

<pre><code>supervisord will emit a SIGTERM signal when a stop is requested. Your child can very probably catch and process this signal (the stopsignal configuration can change the signal sent).

http://stackoverflow.com/a/20299217/1020642
</code></pre>

<p>But my child CAN’T catch and process that signal. In fact, it <a href="https://github.com/unbit/uwsgi/issues/296#issuecomment-36086359">actually totally ignores it</a>. It trips over it and brutally reloads the stack if I’m running <code>uwsgi</code> prior to 2.1.</p>

<pre><code>$ uwsgi --version
2.0.9
</code></pre>

<p>So to fix this bug, we either need to upgrade <code>uwsgi</code>, or send the <code>die-on-term</code> option, which will correct this behavior. Adding the <code>die-on-term</code> directive is the quicker and less potentially problematic version. This will go in our <code>uwsgi.ini</code> file:</p>

<pre><code>[uwsgi]
... stuff ...
processes=4
threads=256
harakiri=20
max-requests=5000
die-on-term=True # yay
... stuff ...
</code></pre>

<p>And now we’ll reload and give it a shot. </p>

		<a class="twitter-share-button" href="http://twitter.com/share" data-url="http://josephmosby.com/2015/10/21/nginx-wont-timeout-and-other-tails-from-the-logfiles.html" data-via="josephmosby">Tweet</a>
	</div>
</div>


<div class="row">
	<div class="col-offset-3 col-8">
		<div class="pagination">
			
			<span class="previous">Previous</span>
			

			<span class="page_number">Page: 1 of 8</span>

			
			<a href="/page2" class="next">Next</a>
			
		</div>
	</div>
</div>
			</div>
		</div>

		<div class="wrapper" id="footer">
			<div class="container">
				<div class="row">
					<div class="col-13">
						<p>Brought to you live from Washington, D.C.</p>
					</div>
				</div>
			</div>
		</div>

		<script src="app.js"></script>

		<script>
	
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-45638065-1', 'josephmosby.com');
	    ga('send', 'pageview');
	  
	  	</script>

  		<script>
		window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
		</script>

	</body>

</html>